# FE-02: 注册页面（首次运行）开发任务说明书

## 一、任务信息

- 任务ID: FE-02
- 名称: 注册页面（仅首次运行显示）
- 复杂度: M（约 3 PD）
- 优先级: P0
- 依赖: F-01（项目结构）、B-01（认证API）
- 相关: FE-03（登录页）

---

## 二、背景与目标

首次运行时，若系统内无用户，应出现注册页面，引导创建管理员账号；注册成功后自动登录进入主界面。若已有用户存在，注册接口会返回 403/409，前端应自动跳转登录页。

---

## 三、页面与交互

- 路径: `/register`
- 表单字段:
  - 用户名 `username`（必填，3-50 字符，唯一）
  - 邮箱 `email`（可选，格式校验）
  - 密码 `password`（必填，≥8，建议包含字母、数字、符号）
  - 确认密码 `confirmPassword`（必填，与密码一致）
- 交互流程:
  1. 填写表单并提交
  2. 成功: 自动登录并跳转首页 `/`
  3. 失败:
     - 403/409: 已有用户或冲突 → 重定向 `/login`
     - 其它: 在表单顶部以 `ElAlert` 展示错误消息
- UI/UX:
  - 使用 Element Plus `el-form` + `el-input` + `el-button`
  - 提交中展示 loading；禁用按钮防止重复提交
  - 支持回车提交；聚焦首个输入框

---

## 四、前后端契约

- 请求（前端层）: `RegisterData`（见 `frontend/src/api/types.ts`）
  ```ts
  interface RegisterData {
    username: string
    email: string
    password: string
    confirmPassword: string
  }
  ```
  说明: `confirmPassword` 仅用于前端校验，不传给后端。

- 实际发送给后端的请求体:
  ```json
  { "username": "admin", "password": "P@ssw0rd", "email": "admin@example.com" }
  ```

- 后端端点: `POST /api/v1/auth/register`
  - 首次运行成功: 返回统一响应，`data` 中包含 `user` 与 `access_token`
  - 已存在用户: 403（禁止）或 409（冲突）

- 成功后处理:
  - 从响应中获得 `access_token`，写入 `auth` store（`token`、`isLoggedIn=true`）
  - 调用 `/auth/me` 获取并填充 `user` 信息
  - 跳转首页

---

## 五、状态与路由守卫

- Pinia: 复用 `useAuthStore`
- 路由: 未登录访问受保护路由跳 `/login`；注册成功后重置到 `/`
- 首次运行判定: 直接尝试注册，若 403/409 → 认为非首次，跳转 `/login`

---

## 六、表单校验规则

- 用户名: 必填，3-50 字符
- 邮箱: 可选，格式校验
- 密码: 必填，≥8；建议包含字母、数字、符号
- 确认密码: 必填，需等于密码

---

## 七、错误处理

- 业务错误: 后端返回 `{ code, message }` → 顶部 `ElAlert`
- HTTP 错误: 由拦截器统一处理；401/403 时跳转 `/login`

---

## 八、实现要点

- 组件位置: `frontend/src/views/auth/Register.vue`
- API 调用: `authAPI.register()` → 成功后调用 `authAPI.getUserInfo()`
- Store 更新: `auth.token`、`auth.isLoggedIn=true`、`auth.user`
- 提交按钮 loading 与防抖

---

## 九、测试用例（要点）

- 首次运行注册成功 → 自动登录与跳转
- 已存在用户 → 注册页提交后收到 403/409 自动跳转 `/login`
- 表单校验（用户名、密码长度、确认密码一致、邮箱格式）
- 错误展示：服务端 message 与网络错误

---

## 十、验收标准

1. 首次运行注册可用，自动登录并进入主界面
2. 非首次运行注册被拒并跳转到登录页
3. 校验与错误提示明确，交互流畅
4. 与 B-01 后端契约一致，拦截器工作正常

---

## 十一、进度追踪（Checklist）

- [x] 任务文档（本文件）
- [x] 契约对齐（与 `api/types.ts`、B-01）
- [ ] 视图骨架与表单布局
- [ ] 表单校验与交互（loading/禁用/回车提交）
- [ ] API 联调与首运行分支处理（403/409 → `/login`）
- [ ] Store 集成与跳转逻辑
- [ ] 手动测试与截图记录
- [ ] 路由守卫与未登录访问拦截


