# FE-04: 主设置页面 UI 开发任务说明书

## 一、任务信息

- 任务ID: FE-04
- 名称: 主设置页面 UI（Sonarr / Prowlarr / 代理）
- 复杂度: L（约 5 PD）
- 优先级: P0
- 依赖: F-01（项目结构）、FE-02（注册）、FE-03（登录）
- 相关: FE-05（与后端 B-02 API 联调）、B-02（配置模块 API）

---

## 二、目标与范围（Scope）

- 目标：完成"配置中心"单页 UI，包括 Sonarr、Prowlarr、网络代理三个配置卡片，字段精简、布局清晰。
- 范围：
  - 单页路由 `/config`（`frontend/src/views/config/index.vue`）
  - 布局：服务配置两列（Sonarr/Prowlarr）+ 代理配置单行横向（页面底部）
  - 字段精简：
    - Sonarr/Prowlarr：服务地址、API 密钥、启用代理开关
    - 代理：代理地址、代理类型（HTTP/HTTPS/SOCKS5）、超时时间（毫秒）
  - 完成表单校验、按钮状态管理、测试连接占位、统一样式
- 非范围（交由 FE-05）：
  - 与后端接口的真实读写、连接测试请求发送与结果处理
  - 敏感字段真实回显策略与加密遮蔽逻辑（UI 仅提供占位及说明）

---

## 三、信息架构与导航

- 路由：`/config` → `views/config/index.vue`（单页）
- 页面结构：
  - 页面标题："配置中心"
  - 页面操作：右侧提供“刷新”按钮，用于重新拉取后端配置概览
  - 服务配置网格（Sonarr + Prowlarr 两列，小屏纵向堆叠）
  - 代理配置卡片（横向单行，占满宽度；位于页面下方）
  - 测试状态展示（按钮内状态图标 + 全局消息提示）
- 视觉风格：延续 `macaron-card`，暗色模式适配，响应式布局

---

## 四、页面与交互设计

### 4.0 全局操作（页头）
- 刷新：点击“刷新”按钮触发重新加载配置（调用后端概览接口），过程中显示 Loading 状态，完成后给出成功提示。

### 4.1 代理配置卡片（单行横向）
- 字段：
  - `address` 代理地址（支持 http/https/socks5）
  - `type` 代理类型（可选：`http`/`https`/`socks5`）
  - `timeout` 超时时间（毫秒，范围 1000-30000）
- 横向布局：地址区域占 1 列；类型与超时并排；底部提供说明提示区
- 操作：重置、测试连通性、保存代理
- 校验：地址格式校验（http/https/socks5）；地址为空时禁用测试按钮

### 4.2 Sonarr 配置卡片
- 字段：
  - `url` 服务地址（必填，http://）
  - `apiKey` API 密钥（必填，密文显示/支持"显示/隐藏"）
  - `useProxy` 启用代理（开关）
- 操作：重置、测试连接、保存
- 校验：
  - `url`：必填，合法 URL（http/https）
  - `apiKey`：必填，长度 ≥ 8

### 4.3 Prowlarr 配置卡片
- 字段与 Sonarr 完全一致
- 文案区分索引器语境（"配置 Prowlarr 索引器连接"）

---

## 五、组件与技术方案

- 技术栈：Vue 3 + TypeScript + Element Plus + Pinia（仅本地 UI 状态）。
- 组件：
  - `ConfigFormCard`：统一卡片容器（标题、副标题、操作栏插槽）。
  - `SecretInput`：密钥/密码输入组件（显示/隐藏、占位提示）。
  - 测试结果展示采用按钮状态图标 + 全局消息提示（`ElMessage`），不再单独引入 `ConnectionResult` 组件。
- 状态管理：FE-04 阶段使用组件本地 `ref` 存储编辑态，保留与 FE-05 对接的钩子方法占位（`onSave`/`onTest`）。

---

## 六、样式与可用性

- 输入框对齐、标签对齐与错误提示一致化；错误信息放置在输入下方。
- 按钮状态：
  - 未变更或校验失败 → 保存禁用
  - 测试中 → 禁用相应按钮并显示 Loading
- 文案：对敏感字段提供说明（例如“出于安全考虑，已保存的密钥不会回显明文”）。
- 可访问性：为输入/按钮添加可读 `aria-label`，保证键盘可导航与聚焦态可视。

---

## 七、与后端契约（占位说明，联调移交 FE-05）

- 后端参考：`docs/tasks/B-02_配置模块API.md`，统一前缀 `/api/v1/config/*`。
- 前端当前占位 API：`frontend/src/api/config.ts` 中存在与 B-02 不一致的路径（如 `/config/sonarr`、`/config/prowlarr`、`/config/proxy`、`/config/{type}/test`）。
- 约定：FE-04 仅实现 UI，不触发真实请求；FE-05 将完成：
  - API 路径统一与适配（建议收敛至 B-02 的 REST 设计与 `test-connection` 端点）。
  - 敏感字段遮蔽与占位提示的联动处理。

---

## 八、验收标准（Acceptance Criteria）

1. `/config` 单页包含 Sonarr/Prowlarr（两列）+ 代理（横向）三个卡片，字段精简，样式一致。
2. 代理卡片横向布局（地址 + 类型 + 超时），服务卡片纵向布局，大屏两列小屏堆叠。
3. 表单的保存/测试/重置按钮具备合理的启用/禁用与 Loading 交互（占位逻辑即可）。
4. API 密钥输入提供"显示/隐藏"切换，默认密文显示；提供安全提示文案。
5. UI 在暗色/亮色模式下均显示清晰；响应式布局稳健。
6. 测试连接结果通过按钮状态图标与全局消息提示（`ElMessage`）展示。
7. 页面头部提供“刷新”按钮，可重新拉取并正确回显最新配置。

---

## 九、测试要点（UI 层）

- 表单渲染：字段与标签完整，默认值与占位符正确。
- 校验：必填项拦截、生效提示、边界长度/格式校验。
- 按钮：在不同状态下的禁用/加载态切换正确。
- 可访问性：键盘导航、焦点样式、屏幕阅读器标签。
- 暗黑模式：颜色对比度与可读性。

---

## 十、实现要点与拆解

- 为每个视图页面引入统一的表单容器与操作栏插槽，减少样式分散。
- 将校验规则抽取为 `rules` 对象，便于后续 FE-05 共享与单测。
- 为“测试连接”预留 `onTest()` 钩子（仅 UI 态变化），后续接入 B-02 的 `test-connection`。
- 对敏感输入使用受控组件，禁止浏览器自动填充（`autocomplete="new-password"`）。

---

## 十一、进度追踪（Checklist）

- [x] 任务文档（本文件）
- [x] 低保真交互稿（字段与按钮排布）
- [x] 通用组件创建（ConfigFormCard、SecretInput）
- [x] Sonarr 表单 UI 完成
- [x] Prowlarr 表单 UI 完成
- [x] 代理设置表单 UI 完成
- [x] 统一表单校验与错误提示
- [x] 按钮状态/Loading/重置逻辑完成
- [x] 暗黑模式与可访问性检查
- [x] UI 自测与截图记录（待用户验收）

---

## 十二、里程碑与估算（5 PD）

- Day 1：交互稿与表单字段清单确认；搭建 `ConfigFormCard` 原型。
- Day 2：完成 Sonarr 表单 UI 与校验。
- Day 3：完成 Prowlarr 表单 UI 与校验。
- Day 4：完成 代理设置 UI 与校验；统一 Loading/禁用态。
- Day 5：整体样式打磨、无障碍与暗黑模式检查、补充文档与截图。

---

## 十三、风险与对策

- 契约差异：前端现有路径与 B-02 设计不一致 → FE-05 做统一适配层；FE-04 避免写死具体路径。
- 敏感字段回显策略：UI 需有明确说明，FE-05 承接具体遮蔽与占位处理。
- 代理设置复杂度：多种代理并存与 `no_proxy` 语义 → 明确前端输入格式与清洗规则。

---

## 十四、参考与附件

- 后端 API 设计：`docs/tasks/B-02_配置模块API.md`
- 现有路由：`frontend/src/router/index.ts`
- 视图文件：`frontend/src/views/config/index.vue`


