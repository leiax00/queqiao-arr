# FE-03: 登录页面开发任务说明书

## 一、任务信息

- 任务ID: FE-03
- 名称: 登录页面
- 复杂度: M（约 3 PD）
- 优先级: P0
- 依赖: F-01（项目结构）、B-01（认证API）
- 相关: FE-02（注册页）

---

## 二、目标

提供安全、清晰的登录体验；使用后端 `/auth/login` 获取 JWT，写入 Store 并拉取用户信息；错误时给予合理的反馈；支持刷新令牌与登出流程。

---

## 三、页面与交互

- 路径: `/login`
- 表单字段:
  - 用户名 `username`（必填）
  - 密码 `password`（必填）
- 交互流程:
  1. 填写用户与密码
  2. 提交后调用 `authAPI.login`
  3. 成功: 保存 `access_token`，`isLoggedIn=true`，调用 `getUserInfo`，跳转首页 `/`
  4. 失败: 顶部 `ElAlert` 展示后端 message 或统一错误
- UI/UX:
  - 使用 Element Plus 表单与按钮
  - 提交 loading、防重复提交
  - 提供前往注册页链接（当首次运行失败被引导到登录页时）

---

## 四、前后端契约

- 请求（前端层）: `LoginData`（见 `frontend/src/api/types.ts`）
  ```ts
  interface LoginData {
    username: string
    password: string
  }
  ```

- 后端端点: `POST /api/v1/auth/login`
  - 成功: 统一响应，`data` 中包含 `access_token`、`expires_in`、`token_type`
  - 失败: 401（用户名或密码错误）

- 成功后处理:
  - 保存 token 至 `auth` store
  - 拉取 `/auth/me` 填充用户信息
  - 跳转首页

---

## 五、状态与路由守卫

- Pinia: `useAuthStore` 的 `isAuthenticated` 控制访问
- 未登录访问受保护路由时 → 重定向 `/login`
- 已登录访问 `/login` 时 → 重定向 `/`

---

## 六、错误处理

- 业务错误: 后端 `{ code, message }` → 顶部 `ElAlert`
- 401: “用户名或密码错误”
- 其它网络错误: 使用全局拦截器默认提示

---

## 七、实现要点

- 组件位置: `frontend/src/views/auth/Login.vue`
- API 调用: `authAPI.login()`、`authAPI.getUserInfo()`
- Store 更新: `token`、`isLoggedIn`、`user`
- 记住登录（可选）: 使用 `pinia-plugin-persistedstate` 保留 `token`

---

## 八、测试要点

- 正确凭据登录成功流程（token、用户信息、跳转）
- 错误凭据 401 提示
- 登录后访问 `/login` 的重定向
- 未登录访问受保护路由的重定向

---

## 九、验收标准

1. 登录成功获取 token，能进入主界面
2. 错误凭据得到明确提示
3. 路由守卫生效，已登录/未登录跳转正确
4. 与 B-01 契约一致，拦截器工作稳定

---

## 十、进度追踪（Checklist）

- [x] 任务文档（本文件）
- [x] 契约对齐（与 `api/types.ts`、B-01）
- [ ] 视图骨架与表单布局
- [ ] 表单校验与交互（loading/禁用/回车提交）
- [ ] API 联调与错误处理（401 等）
- [ ] Store 集成与跳转逻辑
- [ ] 手动测试与截图记录
- [ ] 路由守卫与未登录访问拦截


