# FE-07: 系统字典管理页面 UI 开发任务说明书

## 一、任务信息

- 任务ID: FE-07
- 名称: 系统字典管理页面（字典类型与字典项的列表/搜索/分页/新增编辑删除）
- 复杂度: S（约 2 PD）
- 优先级: P1
- 依赖: F-01（项目结构）、FE-03（登录）、B-11（系统字典管理API）
- 相关: B-11（系统字典管理API）

---

## 二、目标与范围（Scope）

- 目标：完成"系统字典管理"页面，支持字典类型与字典项的列表展示、搜索、分页、新增、编辑、删除操作。
- 范围：
  - 单页路由 `/system/dict`（`frontend/src/views/system/dict/index.vue`）
  - 布局：左侧字典类型列表（树形或列表），右侧字典项表格（带搜索、分页、操作列）
  - 功能：
    - 字典类型：新增、编辑、删除、启用/禁用
    - 字典项：新增、编辑、删除、启用/禁用、排序、层级展示（预留）
  - 完成表单校验、按钮状态管理、二次确认、统一样式
- 非范围：
  - 批量导入/导出字典数据
  - 字典项的多语言支持
  - 字典变更历史审计

---

## 三、信息架构与导航

- 路由：`/system/dict` → `views/system/dict/index.vue`（单页，左右布局）
- 页面结构：
  - 左侧面板（25% 宽度）：
    - 标题："字典类型"
    - 操作：顶部"新增类型"按钮
    - 列表：字典类型列表（支持点击切换，当前选中高亮）
    - 项展示：类型名称、启用状态（图标）、操作按钮（编辑、删除）
  - 右侧面板（75% 宽度）：
    - 标题："字典项管理 - [当前类型名称]"
    - 操作：顶部搜索框 + "新增字典项"按钮
    - 表格：字典项列表（编码、名称、值、排序、状态、扩展数据、操作）
    - 分页：底部分页器
- 视觉风格：延续 `macaron-card`，暗色模式适配，响应式布局

---

## 四、页面与交互设计

### 4.1 字典类型管理（左侧面板）

#### 4.1.1 字典类型列表
- 展示内容：
  - 类型名称（`name`）
  - 启用状态（图标：启用 ✓ / 禁用 ✗）
  - 操作按钮：编辑、删除
- 交互：
  - 点击类型项 → 右侧加载该类型下的字典项列表
  - 当前选中类型高亮显示
- 排序：按 `id` 或 `created_at` 升序

#### 4.1.2 新增字典类型
- 触发：点击"新增类型"按钮 → 弹出对话框
- 字段：
  - `code`：类型编码（必填，唯一，英文/数字/下划线，如 `language`）
  - `name`：类型名称（必填，如"语言选项"）
  - `description`：描述（可选，多行文本）
  - `is_active`：是否启用（开关，默认启用）
- 校验：
  - `code`：必填，格式校验（英文/数字/下划线），长度 2-50
  - `name`：必填，长度 2-100
- 提交：调用 `POST /api/v1/dict/types`，成功后刷新左侧列表

#### 4.1.3 编辑字典类型
- 触发：点击类型项的"编辑"按钮 → 弹出对话框
- 字段：同新增，但 `code` 为只读（不可修改）
- 提交：调用 `PUT /api/v1/dict/types/{type_id}`，成功后刷新列表

#### 4.1.4 删除字典类型
- 触发：点击类型项的"删除"按钮 → 二次确认弹窗
- 提示："删除字典类型将同时删除该类型下的所有字典项，此操作不可恢复，是否确认删除？"
- 提交：调用 `DELETE /api/v1/dict/types/{type_id}`，成功后刷新列表，若当前选中该类型则清空右侧

---

### 4.2 字典项管理（右侧面板）

#### 4.2.1 字典项列表
- 表格列：
  - 编码（`code`）
  - 名称（`name`）
  - 值（`value`）
  - 排序（`sort_order`）
  - 状态（`is_active`，标签：启用/禁用）
  - 扩展数据（`extra_data`，展示为 JSON 字符串或格式化展示，如图标）
  - 操作（编辑、删除）
- 排序：按 `sort_order` 升序，再按 `id` 升序
- 分页：默认每页 20 条，支持切换（10/20/50/100）

#### 4.2.2 搜索与筛选
- 搜索框：支持按 `code` 或 `name` 模糊搜索（前端过滤或后端接口支持 `q` 参数）
- 筛选：
  - 状态筛选：全部/启用/禁用（下拉选择）
  - 层级筛选（预留）：按 `parent_id` 筛选（V1 可选实现）

#### 4.2.3 新增字典项
- 触发：点击"新增字典项"按钮 → 弹出对话框
- 字段：
  - `dict_type_code`：字典类型（自动填充当前选中类型，只读）
  - `code`：项编码（必填，唯一，英文/数字/下划线/中划线，如 `zh-CN`）
  - `name`：显示名称（必填，如"简体中文"）
  - `value`：实际值（必填，如 `zh-CN`）
  - `sort_order`：排序（数字，默认 0）
  - `parent_id`：父项（可选，下拉选择当前类型下的其他项，V1 可为 `null`）
  - `is_active`：是否启用（开关，默认启用）
  - `extra_data`：扩展数据（可选，JSON 格式，提供代码编辑器或结构化表单，如 `{ "icon": "🇨🇳" }`）
- 校验：
  - `code`：必填，格式校验，长度 1-50
  - `name`：必填，长度 1-100
  - `value`：必填，长度 1-200
  - `sort_order`：数字，范围 0-9999
  - `extra_data`：可选，若填写需为合法 JSON
- 提交：调用 `POST /api/v1/dict/items`，成功后刷新右侧表格

#### 4.2.4 编辑字典项
- 触发：点击字典项的"编辑"按钮 → 弹出对话框
- 字段：同新增，但 `dict_type_code` 与 `code` 为只读（不可修改）
- 提交：调用 `PUT /api/v1/dict/items/{item_id}`，成功后刷新表格

#### 4.2.5 删除字典项
- 触发：点击字典项的"删除"按钮 → 二次确认弹窗
- 提示："是否确认删除该字典项？此操作不可恢复。"
- 若该项有子项（`parent_id` 关联），额外提示："该字典项存在子项，删除将同时删除所有子项。"
- 提交：调用 `DELETE /api/v1/dict/items/{item_id}`，成功后刷新表格

---

### 4.3 状态与加载管理

- 加载状态：
  - 左侧加载字典类型列表时显示骨架屏
  - 右侧加载字典项列表时显示表格加载态
- 空状态：
  - 左侧无类型：显示"暂无字典类型，请点击新增"
  - 右侧未选中类型：显示"请在左侧选择字典类型"
  - 右侧无字典项：显示"暂无字典项，请点击新增"
- 错误处理：
  - API 失败显示全局消息提示（`ElMessage.error`）
  - 表单校验失败显示字段级错误提示

---

## 五、组件与技术方案

- 技术栈：Vue 3 + TypeScript + Element Plus + Pinia（可选，用于状态管理）
- 组件：
  - `DictTypeList.vue`：字典类型列表组件（左侧面板）
  - `DictItemTable.vue`：字典项表格组件（右侧面板）
  - `DictTypeForm.vue`：字典类型表单对话框（新增/编辑）
  - `DictItemForm.vue`：字典项表单对话框（新增/编辑）
- API 封装：`frontend/src/api/dict.ts`
  - `getDictTypes()`, `createDictType()`, `updateDictType()`, `deleteDictType()`
  - `getDictItems()`, `getDictItem()`, `createDictItem()`, `updateDictItem()`, `deleteDictItem()`
- 状态管理：组件本地 `ref`/`reactive` 存储，可选用 Pinia 统一管理字典数据（便于跨组件复用）

---

## 六、样式与可用性

- 布局：左右分栏（响应式：小屏改为上下堆叠或 Tab 切换）
- 表格样式：斑马纹、悬停高亮、操作列固定右侧
- 对话框：表单字段对齐、标签宽度一致、错误提示在输入框下方
- 按钮状态：
  - 表单未变更或校验失败 → 保存/提交按钮禁用
  - 删除操作 → 危险样式（红色）
- 可访问性：为按钮/输入/对话框添加可读 `aria-label`，保证键盘可导航与聚焦态可视

---

## 七、与后端契约

- 后端参考：`docs/tasks/B-11_系统字典管理API.md`，统一前缀 `/api/v1/dict/*`
- 前端 API：`frontend/src/api/dict.ts`
- 数据模型：
  - `DictType`：`{ id, code, name, description, is_active, created_at, updated_at }`
  - `DictItem`：`{ id, dict_type_code, code, name, value, sort_order, parent_id, is_active, extra_data, created_at, updated_at }`
- 分页参数：`page`, `page_size`
- 筛选参数：`is_active`, `parent_id`（可选）
- 搜索参数：`q`（可选，后端支持按 `code` 或 `name` 模糊查询）

---

## 八、验收标准（Acceptance Criteria）

1. `/system/dict` 单页包含左右分栏布局，左侧字典类型列表，右侧字典项表格。
2. 字典类型支持新增、编辑、删除、启用/禁用，操作成功后刷新列表。
3. 字典项支持新增、编辑、删除、启用/禁用，操作成功后刷新表格。
4. 字典项表格支持搜索、分页、排序，展示清晰。
5. 表单校验完整，错误提示友好；删除操作有二次确认。
6. UI 在暗色/亮色模式下均显示清晰；响应式布局稳健。
7. 与后端 B-11 API 联调通过，所有 CRUD 操作正常。

---

## 九、测试要点（UI 层）

- 表单渲染：字段与标签完整，默认值与占位符正确。
- 校验：必填项拦截、格式校验（`code`、JSON）、边界长度校验。
- CRUD 操作：新增、编辑、删除成功后数据刷新正确，状态同步。
- 搜索与分页：搜索结果准确，分页切换正常。
- 二次确认：删除操作弹窗提示清晰，取消/确认逻辑正确。
- 可访问性：键盘导航、焦点样式、屏幕阅读器标签。
- 暗黑模式：颜色对比度与可读性。

---

## 十、实现要点与拆解

1. **左侧面板**：
   - 字典类型列表组件（`DictTypeList.vue`）
   - 支持点击切换当前类型，高亮显示
   - 新增/编辑/删除对话框（`DictTypeForm.vue`）

2. **右侧面板**：
   - 字典项表格组件（`DictItemTable.vue`）
   - 搜索框、筛选器、分页器
   - 新增/编辑/删除对话框（`DictItemForm.vue`）

3. **API 封装**：
   - `frontend/src/api/dict.ts`
   - 统一错误处理与响应拦截

4. **状态管理**：
   - 组件本地状态或 Pinia Store（`useDictStore`）
   - 管理当前选中类型、字典项列表、加载状态

5. **表单校验**：
   - Element Plus 表单校验规则（`rules`）
   - `code` 格式正则：`/^[a-zA-Z0-9_-]+$/`
   - `extra_data` JSON 格式校验

---

## 十一、进度追踪（Checklist）

- [x] 任务文档（本文件）
- [x] API 封装（`api/dict.ts`）✅
- [x] 字典类型列表组件（`DictTypeList.vue`）✅
- [x] 字典类型表单组件（`DictTypeForm.vue`）✅
- [x] 字典项表格组件（`DictItemTable.vue`）✅
- [x] 字典项表单组件（`DictItemForm.vue`）✅
- [x] 主页面集成（`views/system/dict/index.vue`）✅
- [x] 路由配置（`router/index.ts`）✅
- [x] 统一样式与暗黑模式适配 ✅
- [x] 与后端 B-11 联调通过 ✅ **2025-10-22 完成**
- [x] UI 自测与截图记录 ✅

---

## 十二、里程碑与估算（2 PD）

- **Day 1**：
  - API 封装（`api/dict.ts`）
  - 字典类型列表组件（`DictTypeList.vue`）
  - 字典类型表单组件（`DictTypeForm.vue`）
  - 字典类型 CRUD 联调

- **Day 2**：
  - 字典项表格组件（`DictItemTable.vue`）
  - 字典项表单组件（`DictItemForm.vue`）
  - 字典项 CRUD 联调
  - 整体样式打磨、暗黑模式适配、文档补充

---

## 十三、风险与对策

- **布局复杂度**：左右分栏响应式适配（小屏改为 Tab 切换或上下堆叠）→ 使用 Element Plus 的 `ElContainer` 与媒体查询。
- **层级关系展示**：`parent_id` 支持（V1 可选）→ 若实现，使用树形表格或缩进展示；若不实现，字段留空。
- **JSON 编辑**：`extra_data` 需提供友好编辑方式 → 使用代码编辑器组件（如 `monaco-editor`）或结构化表单（根据复杂度选择）。
- **删除级联**：删除类型或父项时需前端二次确认，避免误操作 → 弹窗明确提示级联影响。

---

## 十四、参考与附件

- 后端 API 设计：`docs/tasks/B-11_系统字典管理API.md`
- 现有路由：`frontend/src/router/index.ts`
- 视图文件：`frontend/src/views/system/dict/index.vue`（待创建）
- API 封装：`frontend/src/api/dict.ts`（待创建）

---

## 十五、后续扩展方向

- 批量导入/导出字典数据（CSV/JSON/Excel）
- 字典项的多语言支持（`locale` 字段）
- 字典变更历史审计（版本记录与回滚）
- 软删除与恢复（`deleted_at` 字段）
- 字典项的拖拽排序（调整 `sort_order`）

